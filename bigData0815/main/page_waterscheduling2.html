<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>水质模拟</title>
		<link rel="stylesheet" href="css/style_waterscheduling.css" />
		<script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    	<script type="text/javascript" src="js/common.js"></script>		

		<link rel="stylesheet" href="css/PIEmap.css" />

		<script type="text/javascript" src="PIEWrapperWeb.js"></script>
		<script type="text/javascript" src="Earth.js"></script>
		<script type="text/javascript" src="js/PIEmap.js"></script>
	</head>
		
	<style type="text/css">	
		@font-face{
	     font-family: 'yejing'; 
	     src:
	         url('font/yejing5.ttf') format('truetype');
		}

		select.sty1 {
          /*Chrome和Firefox里面的边框是不一样的，所以复写了一下*/
          border: solid 0px #000;
          border:none;
          color:#00F6FF;
          font-size: 16pt;
          /*height: 38px; 
          line-height: 38px;*/
          /*很关键：将默认的select选择框样式清除*/
          appearance:none;
          -moz-appearance:none;
          -webkit-appearance:none;        
          /*在选择框的最右侧中间显示小箭头图片*/
          background: no-repeat scroll right center transparent;          
        }
        
         .selectoptionbg{
		  background-color:#0E1C3B;
		  color:#00F6FF;
		  }
        	
		/*.ol-overlaycontainer-stopevent
		{
			display:none;
		} */
		
		/*横条样式*/
		input[type=range] {
		  -webkit-appearance: none;/*清除系统默认样式*/
		  width: 100%;
		  background: -webkit-linear-gradient(#0087ED, #0087ED) no-repeat, #ddd;/*设置左边颜色为#61bd12，右边颜色为#ddd*/
		  background-size: 100% 100%;/*设置左右宽度比例*/
		  /*height: 3px;/*横条的高度*/*/
		}
		/*拖动块的样式*/
		input[type=range]::-webkit-slider-thumb {
		  -webkit-appearance: none;/*清除系统默认样式*/
		  height: 15px;/*拖动块高度*/
		  width: 15px;/*拖动块宽度*/
		  background: #fff;/*拖动块背景*/
		  border-radius: 50%; /*外观设置为圆形*/
		  border: solid 5px #ddd; /*设置边框*/
		}
		
		.swal-modal{
			background-color: #00FCFF;
		}
		
		.ol-control{
			display: none;
		}
	</style>
	
	<body>
		<header>		
			<div scrolling="no" allowtransparency="true" style="font-size:14px; position: absolute; left: 50px; top:-5px;width:600px;height: 50px; display:inline;">
				<img src="images/pie.png" style="width: 100px; height: 50px;"/>				
			</div>
			<div class="masked1" style="font-weight: bold;">水 质 模 拟</div>
					
			<div scrolling="no" allowtransparency="true" style="font-size:14px; position: absolute; left: 1350px; top:22px; width:550px;height: 40px; display:inline;">
				<ul class="menu">
					<li><a href="page_home.html">管控大屏</a></li>
					<li><a href="#">水务预警</a>
						<ul class="submenu">
							<li><a href="page_shuiqing.html">水情预警</a></li>
							<li><a href="page_shuizhi.html">水质预警</a></li>
							<li><a href="page_weiyi.html">工程安全</a></li>
							<li><a href="page_videocenter.html">视频预警</a></li>
						</ul>
					</li>
					<li><a href="#" style="color:#00FCFF">流域调度</a>
						<ul class="submenu">
							<li><a href="page_waterFloodScheduling.html">防洪调度</a></li>
							<li><a href="page_waterscheduling.html" style="color:#00FCFF">水质模拟</a></li>
						</ul>
					</li>
					<li><a href="page_guanyang.html">河道管养</a></li>
				</ul>
			</div>
		</header>
					
		<canvas id="canvas" style="position: absolute; left: 680px; top:0px; width: 580px; height: 80px;"></canvas>
		
		<div id="content">
			<div class="content_center">
				<div class="center_top">
					<div class="title"><img id="switchMapZoomID" src="images/icon03.png" /> 地图</div>					
					<span id="localtime" style="font-size:18pt; font-family:yejing; font-weight:bold;position: absolute; left: 100px; top:140px; width:100px;z-index: 9990;">10:00:00</span>
					<span id="localtime2" style="font-size:40pt; font-family:yejing; font-weight:bold;position: absolute; left: 220px; top:140px; width:100px;z-index: 9990;">10:00:00</span>
					<iframe name="weather_inc" src="http://i.tianqi.com/index.php?c=code&id=48&color=%232FEDA5" width="180" height="150" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="position: absolute; left: 1120px; top:140px; z-index: 9990;"></iframe>
					
					<div class="center_top_con" id="distribution_map">
						<canvas id="mapContainer" oncontextmenu="return false"></canvas>
					</div>
				</div>
								
				<div class="center_bot">
					<div class="title"><img src="images/icon04.png" /> 断面水质</div>
					<div id="centerBotDiv" class="chartpanel">
					</div>
					<div id="slider-range-max" class="rangDiv">
						<label style="color: #0087ED;font-size: 12pt;">时刻：</label>
						<input type="range" id="myRange" style="width: 1100px;" max="25" min="0" value="0" step="1" onchange="waterQIndexChange();">
						<label id="labelRangeValueID" style="color: #0087ED;font-size: 12pt;"> 10:00:00</label>
					</div>
				</div>
			</div>
			<div class="content_right">
				<div class="news_report">
					<div class="title"><img src="images/data_select.png" onclick="showDateSelect();"/> 调度方案</div><!--<img src="images/icon05.png" />-->
					<div class="news_list">
						<table id="planTable" class="panel-table" border="1">
	                        <tbody id="">
	                        <tr class="aaa" align="center">
	                        	<td v-for="item in tableHeader" style="color: #00fcff; font-size: 18px; padding: 5px 0;">{{ item.categories }}</td>
	                        </tr>
	                        </tbody>
	                    </table>
					</div>
				</div>
								
				<div class="news_report2">
					<div class="title"><img src="images/icon02.png" /> 考核断面</div>
					<div class="news_list2">
						<ul>
							<li style="margin-left: 80px;">
								断面名称：
								<select id="sectionSlID" class="sty1" onchange="circleChartChange();">
									<option class="selectoptionbg" value="1">横沥口</option>
									<option class="selectoptionbg" value="2">茂仔水</option>
									<option class="selectoptionbg" value="3">赤水洞水</option>
									<option class="selectoptionbg" value="4">新田仔</option>
									<option class="selectoptionbg" value="5">深圳水库</option>
								</select>
							</li>							
						</ul>
						<div class="report1">
							<p>水质分类</p>
							<small>{{waterQClass}}</small>
						</div>
						<div id="waterqcircleDiv" class="report2"></div>
						<ul>							
						<div id="waterqchart01ID" class="report_left">
						</div>
						<div id="waterqchart02ID" class="report_right">
						</div>
						<div id="waterqchart03ID" class="report_left">
						</div>
						<div id="waterqchart04ID" class="report_right">
						</div>
					</div>
					
				</div>
				
			</div>
		</div>
				
		<!--遮罩层-->
		<div class="bgPop"></div>
		
		<script>
		    $(document).ready(function () {
		        $('.pop-close').click(function () {
		            $('.bgPop,.pop').hide();
		        });
		        $('.click_pop').click(function () {
		            $('.bgPop,.pop').show();
		        });
		    })
		
		</script>
		<!--遮罩层-->
		<div class="bgPop2"></div>
		<!--弹出框-->
		<div class="pop2">
		    <div class="pop-top">
		        方案信息
		    </div>
		    <div class="pop-content">
		        <table id="pop2_tableID" class="panel-table" bordercolor="#deefff" border="1">
                    <tbody>
                    <tr class="aaa" style="font-size: 16px;" align="center" >
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr class="aaa" style="font-size: 16px;" align="center" >
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    </tbody>
                </table>
		    </div>
		    <div class="pop-foot">
		        <input type="button" value="确定" class="pop-cancel pop-close">
		    </div>
		</div>
		<script>
		    $(document).ready(function () {
		        $('.pop-close').click(function () {
		            $('.bgPop2,.pop2').hide();
		        });
		        $('.click_pop2').click(function () {
		            $('.bgPop2,.pop2').show();
		        });
		    })
		</script>
			
		<!--遮罩层-->
		<div class="bgPop3"></div>
		<!--弹出框-->
		<div class="pop3">
		    <div class="pop-top">
		        选择日期
		        <span class="pop-close">Ｘ</span>
		    </div>
		    <div class="pop-content">
		    	<div style="text-align: center;font-size: 40pt;height: 100%;vertical-align: middle;padding-top:60px;">
		    		<select id="dateYearSelectID" class="sty1" style="font-size: 40pt;">
						<option class="selectoptionbg" value="2019">2019</option>
						<option class="selectoptionbg" value="2">2018</option>
					</select>
					<label>年</label>
					<select id="dateMonthSelectID" class="sty1" style="font-size: 40pt;">
						<option class="selectoptionbg" value="1">01</option>
						<option class="selectoptionbg" value="2">02</option>
					</select>
					<label>月</label>
					<select id="dateDaySelectID" class="sty1" style="font-size: 40pt;">
						<option class="selectoptionbg" value="1">01</option>
						<option class="selectoptionbg" value="2">02</option>
					</select>
					<label>日</label>
		    	</div>		        
		    </div>
		    <div class="pop-foot">
		        <input id="dataSelectID" type="button" value="确定" class="pop-cancel pop-close">
		    </div>
		</div>
		<script>						
		    $(document).ready(function () {
		        $('.pop-close').click(function () {
		            $('.bgPop3,.pop3').hide();
		        });
		        $('.click_pop3').click(function () {
		            $('.bgPop3,.pop3').show();		            
		        });
		        
		        $("#dateYearSelectID").empty();
		        for(var tmpI = 2017; tmpI < 2030; tmpI++)
		        {
      				$("#dateYearSelectID").append("<option class='selectoptionbg' value='"+tmpI+"'>"+tmpI+"</option>'");
		        }
      			$("#dateMonthSelectID").empty();
		        for(var tmpI = 1; tmpI < 13; tmpI++)
		        {
		        	var tmpI2 = tmpI;
		        	if(tmpI<10)
		        		tmpI2 = "0"+tmpI;		        		
      				$("#dateMonthSelectID").append("<option class='selectoptionbg' value='"+tmpI+"'>"+tmpI2+"</option>'");
		        }
		        $("#dateDaySelectID").empty();
		        for(var tmpI = 1; tmpI < 32; tmpI++)
		        {
		        	var tmpI2 = tmpI;
		        	if(tmpI<10)
		        		tmpI2 = "0"+tmpI;
      				$("#dateDaySelectID").append("<option class='selectoptionbg' value='"+tmpI+"'>"+tmpI2+"</option>'");
		        }
		        $('#dataSelectID').click(function () {
		            var tmpStr = $("#dateYearSelectID").val();
		            if($("#dateMonthSelectID").val()<10)
		            	tmpStr += "-0"+$("#dateMonthSelectID").val();
		            else
		            	tmpStr += "-"+$("#dateMonthSelectID").val();
		            if($("#dateDaySelectID").val()<10)
		            	tmpStr += "-0"+$("#dateDaySelectID").val();	
		            else
		            	tmpStr += "-"+$("#dateDaySelectID").val();	
		            m_CurrentQueryData = tmpStr;
		            refreshSchedulingPlan(m_CurrentQueryData);
		        });		        
		    })
		</script>
		
		<!--背景动画        -->
		<script type="text/javascript" src="js/bgannimation.js" ></script>	
		<script type="text/javascript" src="js/jquery.min.js"></script>		
		<script type="text/javascript" src="js/echarts.min.js"></script>
		<script type="text/javascript" src="js/vue.min.js"></script>
		<script type="text/javascript" src="js/times.js"></script>
		<script type="text/javascript" src="js/index.js"></script>
		
		<script type="text/javascript" src="js/CommonJS.js"></script>
		
		<!--调用op库-->	
		<link rel="stylesheet" href="css/ol.css" type="text/css">
		<script src="js/ol.js" type="text/javascript" charset="utf-8"></script>
		
		<link rel="stylesheet" type="text/css" href="overlay/popupoverlay.css" />
		<script type="text/javascript" src="overlay/popupoverlay.js"></script>
		<!--
        	作者：xwebsite@163.com
        	时间：2019-05-07
        	描述：地图相关操作
        -->
		<!-- <script src="js/basicmap_waterscheduling.js" type="text/javascript" charset="utf-8"></script> -->
		
		<!-- sweet-alert库 -->
		<link href="css/sweet-alert.css" rel="stylesheet" type="text/css" />	
		<script src="js/sweet-alert.js"></script>
		
		<script>
		function initialChartCircle(values)
		{
			var dom = document.getElementById("waterqcircleDiv");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;
			option = {
			    radar: [
			        {
			            indicator: [
			                { text: 'COD' },
			                { text: '总氮' },
			                { text: '总磷' },
			                { text: '氨氮' },
			                { text: 'PH' }
			            ],
			            center: ['50%', '50%'],
			            radius: 50,
			            startAngle: 90,
			            splitNumber: 4,
			            shape: 'circle',
			            name: {
			                formatter:'{value}',
			                textStyle: {
			                	fontSize: 14,
			                	padding: [-10, 0],
			                    color:'#72ACD1'
			                }
			            },
			            splitArea: {
			                areaStyle: {
			                    color: ['rgba(114, 172, 209, 0.2)',
			                    'rgba(114, 172, 209, 0.4)', 'rgba(114, 172, 209, 0.6)',
			                    'rgba(114, 172, 209, 0.8)', 'rgba(114, 172, 209, 1)'],
			                    shadowColor: 'rgba(0, 0, 0, 0.3)',
			                    shadowBlur: 10
			                }
			            },
			            axisLine: {
			                lineStyle: {
			                    color: 'rgba(255, 255, 255, 0.5)'
			                }
			            },
			            splitLine: {
			                lineStyle: {
			                    color: 'rgba(255, 255, 255, 0.5)'
			                }
			            }
			        }
			    ],
			    series: [
			        {
			            name: '雷达图',
			            type: 'radar',
			            itemStyle: {
			                emphasis: {
			                    // color: 各异,
			                    lineStyle: {
			                        width: 4
			                    }
			                }
			            },
			            data: [
			                {
			                    value: values,
			                    areaStyle: {
			                        normal: {
			                            color: 'rgba(255, 255, 255, 0.5)'
			                        }
			                    }
			                }
			            ]
			        }
			    ]
			}
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}
		
		var m_CurrentSelectMonitorPara = "COD";
				
		$('#waterqchart01ID').click(function () {
		    m_CurrentSelectMonitorPara = "COD";
		    circleChartChange();
		});
		$('#waterqchart02ID').click(function () {
		    m_CurrentSelectMonitorPara = "TN";
		    circleChartChange();
		});
		$('#waterqchart03ID').click(function () {
		    m_CurrentSelectMonitorPara = "TP";
		    circleChartChange();
		});
		$('#waterqchart04ID').click(function () {
		    m_CurrentSelectMonitorPara = "N3";
		    circleChartChange();
		});
		
		function initialWaterQChart01Control(value01, value02)
		{
			var dom = document.getElementById("waterqchart01ID");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;
			app.title = '用户在线图';
			
			var tmpLabelColor = '#f2f2f2';
			if(m_CurrentSelectMonitorPara == "COD")
				tmpLabelColor = '#ff0000';
			
			option = {
			    tooltip: {
			        trigger: 'item',
			        formatter: "{a} <br/>含量:"+value01+" mg/L"
			    },
			    title: {
			         text: 'COD',
			         textStyle: {
			             color: tmpLabelColor,
			             fontSize: 20,
			             align: 'center'
			         },
			         x: 'center',
			         y: 'center',
			     },
			    color:['#FF0000','#E97D20'],
			    series: [
			        {
			            name:'COD',
			            type:'pie',
			            radius: ['50%', '70%'],
			            avoidLabelOverlap: false,
			            label: {
			                normal: {
			                    show: false,
			                    position: 'center'
			                },
			                emphasis: {
			                    show: false,
			                    textStyle: {
			                        fontSize: '24',
			                        color:'#00fcff',
			                        fontWeight: 'bold'
			                    }
			                }
			            },
			            labelLine: {
			                normal: {
			                    show: false
			                }
			            },
			            data:[
			                {value:value01, name:'占比'},
			                {value:value02 - value01, name:'余下'}
			            ]
			        }
			    ]
			};		
			;
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}

		function initialWaterQChart02Control(value01, value02)
		{
			var dom = document.getElementById("waterqchart02ID");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;	
			var tmpLabelColor = '#f2f2f2';
			if(m_CurrentSelectMonitorPara == "TN")
				tmpLabelColor = '#ff0000';
			option = {
			    tooltip: {
			        trigger: 'item',
			        formatter: "{a} <br/>含量:"+value01+" mg/L"
			    },
			    title: {
			         text: '总氮',
			         textStyle: {
			             color: tmpLabelColor,
			             fontSize: 20,
			             align: 'center'
			         },
			         x: 'center',
			         y: 'center',
			     },
			    color:['#FF0000','#B5C334'],
			    series: [
			        {
			            name:'总氮',
			            type:'pie',
			            radius: ['50%', '70%'],
			            avoidLabelOverlap: false,
			            label: {
			                normal: {
			                    show: false,
			                    position: 'center'
			                },
			                emphasis: {
			                    show: false,
			                    textStyle: {
			                        fontSize: '24',
			                        color:'#00fcff',
			                        fontWeight: 'bold'
			                    }
			                }
			            },
			            labelLine: {
			                normal: {
			                    show: false
			                }
			            },
			            data:[
			                {value:value01, name:'占比'},
			                {value:value02 - value01, name:'余下'}
			            ]
			        }
			    ]
			};		
			;
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}
		
		function initialWaterQChart03Control(value01, value02)
		{
			var dom = document.getElementById("waterqchart03ID");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;		
			var tmpLabelColor = '#f2f2f2';
			if(m_CurrentSelectMonitorPara == "TP")
				tmpLabelColor = '#ff0000';
			option = {
			    tooltip: {
			        trigger: 'item',
			        formatter: "{a} <br/>含量:"+value01+" mg/L"
			    },
			    title: {
			         text: '总磷',
			         textStyle: {
			             color: tmpLabelColor,
			             fontSize: 20,
			             align: 'center'
			         },
			         x: 'center',
			         y: 'center',
			     },
			    color:['#FF0000','#27727B'],
			    series: [
			        {
			            name:'总磷',
			            type:'pie',
			            radius: ['50%', '70%'],
			            avoidLabelOverlap: false,
			            label: {
			                normal: {
			                    show: false,
			                    position: 'center'
			                },
			                emphasis: {
			                    show: false,
			                    textStyle: {
			                        fontSize: '24',
			                        color:'#00fcff',
			                        fontWeight: 'bold'
			                    }
			                }
			            },
			            labelLine: {
			                normal: {
			                    show: false
			                }
			            },
			            data:[
			                {value:value01, name:'占比'},
			                {value:value02 - value01, name:'余下'}
			            ]
			        }
			    ]
			};		
			;
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}
		function initialWaterQChart04Control(value01, value02)
		{
			var dom = document.getElementById("waterqchart04ID");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;	
			var tmpLabelColor = '#f2f2f2';
			if(m_CurrentSelectMonitorPara == "N3")
				tmpLabelColor = '#ff0000';
			option = {
			    tooltip: {
			        trigger: 'item',
			        formatter: "{a} <br/>含量:"+value01+" mg/L"
			    },
			    title: {
			         text: '氨氮',
			         textStyle: {
			             color: tmpLabelColor,
			             fontSize: 20,
			             align: 'center'
			         },
			         x: 'center',
			         y: 'center',
			     },
			    color:['#FF0000','#60C0DD'],
			    series: [
			        {
			            name:'氨氮',
			            type:'pie',
			            radius: ['50%', '70%'],
			            avoidLabelOverlap: false,
			            label: {
			                normal: {
			                    show: false,
			                    position: 'center'
			                },
			                emphasis: {
			                    show: false,
			                    textStyle: {
			                        fontSize: '24',
			                        color:'#00fcff',
			                        fontWeight: 'bold'
			                    }
			                }
			            },
			            labelLine: {
			                normal: {
			                    show: false
			                }
			            },
			            data:[
			                {value:value01, name:'占比'},
			                {value:value02 - value01, name:'余下'}
			            ]
			        }
			    ]
			};		
			;
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}
				
		function initialWaterQCurverChartControl()
		{
			var dom = document.getElementById("centerBotDiv");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;	
			
			option = {
			    tooltip: {
			        trigger: 'axis'
			    },
			    legend: {
			    	orient: 'vertical',
					left: 'right',
					y: 'center',
			        data:['总磷','总氮','氨氮','COD'],
			        textStyle:{//图例文字的样式
			            color:'#ccc',
			            fontSize:16
			        }
			    },
			    grid: {
			        left: 60,
			        right: 100,
			        bottom: '3%',
			        top:'4%',
			        containLabel: true
			    },			    
			    xAxis: {
			        type: 'category',
			        boundaryGap: false,
			        data: ['1#','2#','3#','4#','5#','6#','7#'],
			        splitLine:{show:false},
			        axisLine:{
					    lineStyle:{
					        color:'#0087ED',
					        width:1,//这里是为了突出显示加上的
					    }
					},
			        axisLabel: {
			            show: true,
			            textStyle: {
			                color: '#0087ED',
			                fontSize:16
			            }
			        }		
			    },
			    yAxis: {
			        type: 'value',
			        splitLine:{show:false},
			        axisLine:{
					    lineStyle:{
					        color:'#0087ED',
					        width:1,//这里是为了突出显示加上的
					    }
					},
					axisLabel: {
			            show: true,
			            textStyle: {
			                color: '#0087ED',
			                fontSize:16
			            }
			        }
			    },
			    series: [
			        {
			            name:'总磷',
			            type:'line',			            
			            //stack: '总量',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(1, 132, 213, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(1, 132, 213, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#0184d5',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
						
			            data:[120, 132, 101, 134, 90, 230, 210]
			        },
			        {
			            name:'总氮',
			            type:'line',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(0, 216, 135, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(0, 216, 135, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#00d887',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
			            data:[220, 182, 191, 234, 290, 330, 310]
			        },
			        {
			            name:'氨氮',
			            type:'line',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(255, 0, 0, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(255, 0, 0, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#FF0000',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
						
			            data:[150, 232, 201, 154, 190, 330, 410]
			        },
			        {
			            name:'COD',
			            type:'line',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(233, 125, 32, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(233, 125, 32, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#E97D20',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
			            data:[320, 332, 301, 334, 390, 330, 320]
			        }
			    ]
			};
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}
				
		initialChartCircle([0,0,0,0,0]);
		initialWaterQChart01Control(15,20);//COD
		initialWaterQChart02Control(0.5,1);//总氮
		initialWaterQChart03Control(0.1,0.2);//总磷
		initialWaterQChart04Control(0.5,1);//氨氮
		
		initialWaterQCurverChartControl();
				
		function dateToString(date){ 
		  var year = date.getFullYear(); 
		  var month =(date.getMonth() + 1).toString(); 
		  var day = (date.getDate()).toString();  
		  if (month.length == 1) { 
		      month = "0" + month; 
		  } 
		  if (day.length == 1) { 
		      day = "0" + day; 
		  }
		  var dateTime = year + "-" + month + "-" + day;
		  return dateTime; 
		}
				
		function refreshSchedulingPlan(queryDataTime)
		{						
			var param="101#"+queryDataTime+"#DD#lsd"; 
			RunWebServiceJSON(true, "getAlldispatchplan", 
					"/pms/Base", "/doreaddata/getdata", 
					"topocode#time#sort#userCode", param, function (data) {
						var jqueryObj = $(data);
						var message = jqueryObj.children();
						var text = message.text();
						var tmpObjs = eval("(" + text + ")");
						var tmpDTUTBHTML = '<tbody>'
                        	+'<tr class="aaa" align="center">';
                        //列头
                        tmpDTUTBHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:100px;">方案名称</td>';
                        tmpDTUTBHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:50px;">方案编码</td>';
                        tmpDTUTBHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:50px;">操作</td>';
			            tmpDTUTBHTML+='</tr>';
			            
			            var tmpTTTid = 0;
			            var tmpPlanID = '';
			            var tmpDefaultBtnID = '';
			            for(var tmpI in tmpObjs){
			            	var tmpitem01 = tmpObjs[tmpI];
			            	var tmpBtnID = 'btn_tb_op_'+tmpI;
			            	tmpDTUTBHTML+='<tr class="aaa" style="font-size: 16px;" align="center" >'
			            		+'<td style="color: #00fcff; font-size: 18px; padding: 5px 0;" onclick="openPlanInfo(\''+tmpitem01.planmsg+'\');">'+tmpitem01.PlanCode
			            		+'</td><td style="color: #00fcff; font-size: 18px; padding: 5px 0;">'+tmpitem01.planID
			            		+'</td><td style="color: #00fcff; font-size: 18px; padding: 5px 0;"><button id="'+tmpBtnID+'" class="b2" onclick="exeSchedulingPlan(this,\''
			            		+tmpitem01.planID+'\')">执行</button>'
			            		+'</td></tr>';
			            	if(tmpPlanID == '')
			            		tmpPlanID = tmpitem01.planID;
			            	if(tmpDefaultBtnID == '')
			            		tmpDefaultBtnID = tmpBtnID;
			            	tmpTTTid++;
			            	if(tmpTTTid >= 5)
			            		break;
			            }
			            $("#planTable").html(tmpDTUTBHTML);
			            if(tmpPlanID!='')
			            	exeSchedulingPlan(document.getElementById(tmpDefaultBtnID), tmpPlanID);
					});
		}
		
		var m_SchedulingPlanDataArray = [];
		var m_SchedulingPlanTimeArray = [];
		var m_AutoloopIntervalID = undefined;
		
		/***
		 * 执行方案
		 * @param {Object} planID 方案编号
		 */
		function exeSchedulingPlan(btn, planID)
		{
			//circleChartChange();
			
			$(".b1").addClass("b2");
			$(".b1").text('执行');
			$(".b1").removeClass("b1");
			if(btn!=undefined){
				$(btn).removeClass("b2");
				$(btn).addClass("b1");
				$(btn).text('执行中');
			}
			
			m_SchedulingPlanDataArray = [];
			m_SchedulingPlanTimeArray = [];
			for(var i=0;i<26;i++)
			{
				m_SchedulingPlanDataArray[i] = null;
				m_SchedulingPlanTimeArray[i] = '';
			}	
			if(m_AutoloopIntervalID!=undefined)
				clearInterval(m_AutoloopIntervalID);
			
			for(var i0=0;i0<26;i0++)
			{
				RunWebServiceJSON(true, "getTSDBLeveldata", "/pms/Base", "/doreaddata/getdata",
			        "guid#timeindex", String(planID)+"#"+i0, function (data) {
			        	//m_SchedulingPlanDataArray[i0-1] = null;			        	
						var jqueryObj = $(data);
						var message = jqueryObj.children();
						var text = message.text();
						var tmpObjs = eval("(" + text + ")");
						var tmpDataArray = [], tmpDataArray2 = [];
						var tmpTid = 0, tmpTid2 = 0;
						var tmpTimInt = -1;
						var tmpSkipFirst = true;
						
						for(var tmpI in tmpObjs){
							var tmpObj = tmpObjs[tmpI];
							if(tmpTimInt == -1)
								tmpTimInt = parseInt(tmpObj.MAXS);
							tmpDataArray2[tmpTid2++] = parseFloat(tmpObj.V);
							if(tmpTid2==58)
							{
								//if(tmpSkipFirst == false)
								{
									tmpDataArray[tmpTid++] = tmpDataArray2;
									m_SchedulingPlanTimeArray[tmpTimInt] = tmpObj.TIME;
									tmpDataArray2 = [];
									tmpTid2 = 0;
								}
								tmpSkipFirst = false;								
							}							
						}
						tmpDataArray[tmpTid++] = tmpDataArray2;//总磷、总氮、氨氮、COD
						m_SchedulingPlanDataArray[tmpTimInt] = tmpDataArray;
						//m_SchedulingPlanTimeArray[tmpTimInt] = '';//时刻
						if(tmpTimInt==0)
						{
							initialWaterQCurverChartControlByPlan(tmpDataArray);
							$('#myRange').val(0);
							m_CurrentSchedulingIndex = 0;
							if(m_AutoloopIntervalID!=undefined)
								clearInterval(m_AutoloopIntervalID);
							m_AutoloopIntervalID = setInterval(startLoopSchedulingIndex,3000);///刷新数据
						}
				});
			}
		}
		
		function initialWaterQCurverChartControlByPlan(dataArray)
		{
			var dom = document.getElementById("centerBotDiv");
			var myChart = echarts.init(dom);
			var app = {};
			option = null;	
			
			var tmpXData = [];
			for(var tmpI = 1; tmpI < 58;tmpI++)
				tmpXData[tmpI-1] = String(tmpI)+"#";
			
			option = {
			    tooltip: {
			        trigger: 'axis'
			    },
			    legend: {
			    	orient: 'vertical',
					left: 'right',
					y: 'center',
			        data:['总磷','总氮','氨氮','COD'],
			        textStyle:{//图例文字的样式
			            color:'#ccc',
			            fontSize:16
			        }
			    },
			    grid: {
			        left: 60,
			        right: 100,
			        bottom: '3%',
			        top:'4%',
			        containLabel: true
			    },		
			    color:['#BF00A5','#80C7D6','#FF8923','#8060C0'],
			    xAxis: {
			        type: 'category',
			        boundaryGap: false,
			        data: tmpXData,//['1#','2#','3#','4#','5#','6#','7#'],
			        splitLine:{show:false},
			        axisLine:{
					    lineStyle:{
					        color:'#0087ED',
					        width:1,//这里是为了突出显示加上的
					    }
					},
			        axisLabel: {
			            show: true,
			            textStyle: {
			                color: '#0087ED',
			                fontSize:16
			            }
			        }		
			    },
			    yAxis: {
			        type: 'value',
			        splitLine:{show:false},
			        axisLine:{
					    lineStyle:{
					        color:'#0087ED',
					        width:1,//这里是为了突出显示加上的
					    }
					},
					axisLabel: {
			            show: true,
			            formatter: '{value} mg/L',
			            textStyle: {
			                color: '#0087ED',
			                fontSize:16
			            }
			        }
			    },
			    series: [
//			        {
//			            name:'总磷',
//			            type:'line',
//			            symbol:'none',  //这句就是去掉点的  
//			            //stack: '总量',
//			            smooth: true,
////			            itemStyle : {
////								normal : {
////									lineStyle:{
////										color:'#00FF00'
////									}
////								}
////						},
//			            data:dataArray[0] //[120, 132, 101, 134, 90, 230, 210]
//			        },
//			        {
//			            name:'总氮',
//			            type:'line',
//			            symbol:'none',  //这句就是去掉点的  
//			            //stack: '总量',
//			            smooth: true,
//			            data:dataArray[1] //[220, 182, 191, 234, 290, 330, 310]
//			        },
//			        {
//			            name:'氨氮',
//			            type:'line',
//			            symbol:'none',  //这句就是去掉点的  
//			            //stack: '总量',
//			            smooth: true,
//			            data:dataArray[2] //[150, 232, 201, 154, 190, 330, 410]
//			        },
//			        {
//			            name:'COD',
//			            type:'line',
//			            symbol:'none',  //这句就是去掉点的  
//			            //stack: '总量',
//			            smooth: true,
//			            data:dataArray[3] //[320, 332, 301, 334, 390, 330, 320]
//			        }

			        {
			            name:'总磷',
			            type:'line',			            
			            //stack: '总量',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(1, 132, 213, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(1, 132, 213, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#0184d5',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
						
			            data:dataArray[0]
			        },
			        {
			            name:'总氮',
			            type:'line',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(0, 216, 135, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(0, 216, 135, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#00d887',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
			            data:dataArray[1]
			        },
			        {
			            name:'氨氮',
			            type:'line',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(255, 0, 0, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(255, 0, 0, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#FF0000',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
						
			            data:dataArray[2]
			        },
			        {
			            name:'COD',
			            type:'line',
			            symbol: 'circle',  //这句就是去掉点的  
			            symbolSize: 5,
        				showSymbol: false,
			            smooth: true,
			            areaStyle: {
				            normal: {
				                color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
				                    offset: 0,
				                    color: 'rgba(233, 125, 32, 0.2)'
				                }, {
				                    offset: 0.8,
				                    color: 'rgba(233, 125, 32, 0.1)'
				                }], false),
				                shadowColor: 'rgba(0, 0, 0, 0.1)',
				            }
				        },
						itemStyle: {
							normal: {
								color: '#E97D20',
								borderColor: 'rgba(221, 220, 107, .1)',
								borderWidth: 12
							}
						},
			            data:dataArray[3]
			        }
			        
			    ]
			};
			if (option && typeof option === "object") {
			    myChart.setOption(option, true);
			}
		}
		
		function waterQIndexChange()
		{
			gotoSchedulingIndex();
			var tmpI = $('#myRange').val();
			m_CurrentSchedulingIndex = tmpI;
		}
		
		var m_CurrentSchedulingIndex = 0;
		
		function startLoopSchedulingIndex()
		{
			var tmpLen = m_SchedulingPlanDataArray.length;
			if(m_CurrentSchedulingIndex>=tmpLen)
				m_CurrentSchedulingIndex = 0;
			
			$('#myRange').val(m_CurrentSchedulingIndex);//.trigger('change');
			//initialWaterQCurverChartControlByPlan(m_SchedulingPlanDataArray[m_CurrentSchedulingIndex]);
			gotoSchedulingIndex();
			m_CurrentSchedulingIndex++;
		}
		
		function gotoSchedulingIndex()
		{
			var tmpI = $('#myRange').val();
			var tmpArray = m_SchedulingPlanDataArray[tmpI];
			if(tmpArray!=null)
			{
				initialWaterQCurverChartControlByPlan(tmpArray);
				$('#labelRangeValueID').text(" "+m_SchedulingPlanTimeArray[tmpI]);	
				var tmpIndex = 0;
				if(m_CurrentSelectMonitorPara == "TN")
					tmpIndex = 1;
				else if(m_CurrentSelectMonitorPara == "N3")
					tmpIndex = 2;	
				else if(m_CurrentSelectMonitorPara == "COD")
					tmpIndex = 3;					
				setRiverSectionsValue(tmpArray[tmpIndex]);//设置河道断面监测值
				circleChartChange();				
			}
		}
		/**
		 * 更新圆圈图标
		 */
		function circleChartChange()
		{
			var tmpSectionIndex = $('#sectionSlID').val() - 1;
			var tmpSectionID = m_sectionID[tmpSectionIndex]-1;
			//总磷、总氮、氨氮、COD
			var tmpArray = m_SchedulingPlanDataArray[m_CurrentSchedulingIndex];
			var tmpCOD = tmpArray[3][tmpSectionID];
			var tmpTN = tmpArray[1][tmpSectionID];
			var tmpTP = tmpArray[0][tmpSectionID];
			var tmpN3 = tmpArray[2][tmpSectionID];
			
			initialWaterQChart01Control(tmpCOD, 20);//COD
			initialWaterQChart02Control(tmpTN,tmpTN > 1?tmpTN:1);//总氮
			initialWaterQChart03Control(tmpTP,tmpTP > 0.2?tmpTP:0.2);//总磷
			initialWaterQChart04Control(tmpN3,tmpN3 > 1?tmpN3:1);//氨氮
			
			initialChartCircle([tmpArray[3][tmpSectionID],
				tmpArray[1][tmpSectionID],
				tmpArray[0][tmpSectionID],
				tmpArray[2][tmpSectionID],
				7]);	
				
			refreshWaterQLevelLabel(tmpTN, tmpTP, tmpN3, tmpCOD);			
		}
		/**
		 * 判断总的水质情况
		 * @param {Object} TN
		 * @param {Object} TP
		 * @param {Object} N3
		 * @param {Object} COD
		 */
		function refreshWaterQLevelLabel(TN,TP,N3,COD)
		{
			var tmpL01 = getWaterQLevelBySingleFactor(41, TP);//总磷
			var tmpL02 = getWaterQLevelBySingleFactor(42, COD);//化学需氧量
			var tmpL03 = getWaterQLevelBySingleFactor(43, N3);//氨氮
			var tmpL04 = getWaterQLevelBySingleFactor(44, TN);//总氮
			var tmpL00 = tmpL01;
			if(tmpL00 < tmpL02)
				tmpL00 = tmpL02;
			if(tmpL00 < tmpL03)
				tmpL00 = tmpL03;
			if(tmpL00 < tmpL04)
				tmpL00 = tmpL04;
			var tmpRomanStrs = ['Ⅰ','Ⅱ','Ⅲ','Ⅳ','Ⅴ','Ⅵ'];	
			vm.waterQClass = tmpRomanStrs[tmpL00-1];
		}
		
		function openPlanInfo(planName)
		{
			//planName = "水质应急事件0505001";
			RunWebServiceJSON(true, "getWaterqualityData", "/pms/Base", "/doreaddata/getdata",
		        "planname", planName, function (data) {
					var jqueryObj = $(data);
					var message = jqueryObj.children();
					var text = message.text();
					var tmpObjs = eval("(" + text + ")");
					
					var tmpTotalHTML = '<tr class="aaa" align="center">';
					//列头
                    tmpTotalHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:100px;">断面</td>';
                    tmpTotalHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:50px;">总氮</td>';
                    tmpTotalHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:50px;">总磷</td>';
                    tmpTotalHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:50px;">氨氮</td>';
                    tmpTotalHTML+='<td style="color: #00fcff; font-size: 18px; padding: 5px 0;width:50px;">COD</td>';
			        tmpTotalHTML+='</tr>';
			        
			        var tmpSectionnames = ['横沥口','茂仔水','赤水洞水','彩虹桥入库断面'];
					for(var tmpI in tmpObjs)
					{
						var tmpObj = tmpObjs[tmpI];
						tmpTotalHTML+='<tr class="aaa" style="font-size: 16px;" align="center" >'
			            		+'<td style="color: #00fcff; font-size: 18px; padding: 5px 0;">'+tmpSectionnames[tmpI]
			            		+'</td><td style="color: #00fcff; font-size: 18px; padding: 5px 0;">'+tmpObj.TN
			            		+'</td><td style="color: #00fcff; font-size: 18px; padding: 5px 0;">'+tmpObj.TP
			            		+'</td><td style="color: #00fcff; font-size: 18px; padding: 5px 0;">'+tmpObj.NH3N
			            		+'</td><td style="color: #00fcff; font-size: 18px; padding: 5px 0;">'+tmpObj.COD
			            		+'</td></tr>';
					}
					$('.bgPop2,.pop2').show();
					$('#pop2_tableID').html(tmpTotalHTML);
			});
		}
					        
		function getWaterQLevelBySingleFactor(Foctor,V)
        {
            var ret = 0;
            switch (Foctor)
	        {
                case 41://总磷
                    {
                        //0.02	0.1	0.2	0.3	0.4
                        if (V <= 0.1)
                            ret= 2;
                        else if (V <= 0.2)
                            ret= 3;
                        else if (V <= 0.3)
                            ret= 4;
                        else if (V <= 0.4)
                            ret = 5;
                        else
                            ret= 6;
                        break;
                    }
                case 42://化学需氧量
                    {
                        //15	15	20	30	40
                        if (V <= 15)
                            ret = 2;
                        else if (V <= 20)
                            ret = 3;
                        else if (V <= 30)
                            ret = 4;
                        else if (V <= 40)
                            ret = 5;
                        else
                            ret = 6;
                        break;
                    }
                case 43://氨氮
                    {
                        //0.15	0.5	1	1.5	2
                        if (V <= 0.5)
                            ret = 2;
                        else if (V <= 1)
                            ret = 3;
                        else if (V <= 1.5)
                            ret = 4;
                        else if (V <= 2)
                            ret = 5;
                        else
                            ret = 6;
                        break;
                    }
                case 44://总氮
                    {
                        //0.2	0.5	1	1.5	2
                        if (V <= 0.5)
                            ret = 2;
                        else if (V <= 1)
                            ret = 3;
                        else if (V <= 1.5)
                            ret = 4;
                        else if (V <= 2)
                            ret = 5;
                        else
                            ret = 6;
                        break;
                    }
                case 50://DO
                    {
                        //6	5	3	2
                        if (V >= 6)
                            ret = 2;
                        else if (V >= 5)
                            ret = 3;
                        else if (V >= 3)
                            ret = 4;
                        else if (V >= 2)
                            ret = 5;
                        else
                            ret = 6;
                        break;
                    }
                default:
                    ret=0;
                    break;
	        }
            return ret;
        }					        
		
		function showDateSelect()
		{
			var tmpStrs = m_CurrentQueryData.split('-');
			$("#dateYearSelectID").val(parseInt(tmpStrs[0]));
			$("#dateMonthSelectID").val(parseInt(tmpStrs[1]));
			$("#dateDaySelectID").val(parseInt(tmpStrs[2]));
			$('.bgPop3,.pop3').show();			
		}
		
		/**点击地图可缩放*/
		$("#switchMapZoomID").click(function(){
			var draw = new ol.interaction.MouseWheelZoom();
			M_map.addInteraction(draw);			
			$("#switchMapZoomID").unbind("click");
		});
		
		var m_sectionID = [1,17,25,51,57];
		
		/**查询的日期*/
		var m_CurrentQueryData = dateToString(new Date());
		
		refreshSchedulingPlan(m_CurrentQueryData);
				
		//exeSchedulingPlan(undefined, "9695");
				
		
		// shuiqing.HTML新添加的
		var m_RiverSectionVDataArray = [];
        /**
         * 刷新断面的高程及水面高程数据 自己重新修改的
         * @param {Object} planID
         */
        function refreshSectionElvData(planID) {
            RunWebServiceJSON(true, "getTSDBLeveldata", "/pms/Base", "/doreaddata/getdata",
                "guid#timeindex", String(planID) + "#-1", function (data) {
                    // 						 // 将获取到的数据data转换成JSON字符串
                    //   var jsonData = JSON.stringify(data);

                    //   // 创建一个Blob对象，表示二进制数据
                    //   var blob = new Blob([jsonData], {type: "application/json"});

                    //   // 创建一个a标签，设置download属性为data_riverSection.json
                    //   var a = document.createElement("a");
                    //   a.download = "data_riverSection.json";

                    //   // 将Blob对象转换成URL
                    //   var url = URL.createObjectURL(blob);

                    //   // 设置a标签的href属性为Blob URL
                    //   a.href = url;

                    //   // 模拟点击a标签进行下载
                    //   a.click();

                    //   // 释放Blob URL
                    //   URL.revokeObjectURL(url);


                    var jqueryObj = $(data);
                    var message = jqueryObj.children();
                    var text = message.text();
                    var tmpObjs = eval("(" + text + ")");
                    if (tmpObjs != null && tmpObjs.length > 0) {
                        var tmpArray = [], tmpArray2 = [], tmpArray3 = [], tmpArray4 = [];
                        for (var i in tmpObjs) {
                            var tmpObj = tmpObjs[i];
                            tmpArray[i] = parseFloat(tmpObj.V);
                            tmpArray2[i] = parseFloat(tmpObj.MAXV);
                            tmpArray3[i] = parseFloat(tmpObj.MINV);
                            tmpArray4[i] = tmpArray[i] - tmpArray2[i];
                            if (tmpArray4[i] < 0)
                                tmpArray4[i] = 0;
                        }
                        // initialSectionChartControl([tmpArray,tmpArray2,tmpArray3]);	在shuiqing.html中不需要

                        m_RiverSectionVDataArray = [tmpArray, tmpArray2, tmpArray3, tmpArray4];

                        // 		           // 下载保存数据为JSON文件
                        // 				   var jsonData = JSON.stringify(m_RiverSectionVDataArray);
                        // var blob = new Blob([jsonData], {type: "application/json"});
                        // var fileName = "data_RiverSectionVArray.json";
                        // if (window.navigator.msSaveOrOpenBlob) {
                        //     window.navigator.msSaveBlob(blob, fileName);
                        // } else {
                        //     var elem = window.document.createElement('a');
                        //     elem.href = window.URL.createObjectURL(blob);
                        //     elem.download = fileName;
                        //     document.body.appendChild(elem);
                        //     elem.click();
                        //     document.body.removeChild(elem);
                        // }

                        refreshMapRiverShow();
                    }
                });
        }

        // shuiqing.html要去除userGPSLayer  GYEventLayer  basemapTxtLayer
        setTimeout(function () {
            for (var i in entityCollection._entities) {
                // console.log(i)
                if (entityCollection._entities[i].layer === 'GYEventLayer' || entityCollection._entities[i].layer === 'userGPSLayer') {
                    entityCollection._entities[i].show = !entityCollection._entities[i].show;
                    entityCollection._entities[i].labelBox.show = false;
                }
            }
            viewer.imageryLayers.remove(layer_basemapTxt)
        }, 1000);
	</script>
		
		
	</body>
</html>
